<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-java/jvm/oom">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/wiki/blog/rss.xml" title="Dev Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/wiki/blog/atom.xml" title="Dev Wiki Atom Feed">




<link rel="stylesheet" href="/wiki/katex/katex.min.css"><title data-rh="true">理解 OutofmemoryError | Dev Wiki</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://souo.gitee.io/wiki/docs/java/jvm/oom"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="理解 OutofmemoryError | Dev Wiki"><meta data-rh="true" name="description" content="内存泄漏的一个常见指示是 java.lang.OutOfMemoryError 异常。"><meta data-rh="true" property="og:description" content="内存泄漏的一个常见指示是 java.lang.OutOfMemoryError 异常。"><link data-rh="true" rel="canonical" href="http://souo.gitee.io/wiki/docs/java/jvm/oom"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/jvm/oom" hreflang="en"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/jvm/oom" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://undefined-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/wiki/assets/css/styles.a6de386b.css">
<link rel="preload" href="/wiki/assets/js/runtime~main.356aa08e.js" as="script">
<link rel="preload" href="/wiki/assets/js/main.1a942207.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/wiki/"><b class="navbar__title text--truncate">知识库</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/wiki/get-started">Get Started</a><a class="navbar__item navbar__link" href="/wiki/docs/welcome">Docs</a><a class="navbar__item navbar__link" href="/wiki/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">WIKI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/wiki/docs/java/jvm/jvm-architecture">Java</a></li><li><a class="dropdown__link" href="/wiki/docs/bigdata/hbase/hbase-architecture">BigData</a></li><li><a class="dropdown__link" href="/wiki/docs/math/quick-power">math</a></li><li><a class="dropdown__link" href="/wiki/docs/db/profiling/sql">数据库</a></li><li><a class="dropdown__link" href="/wiki/docs/questions/java/class_file">面试题</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/welcome">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/wiki/docs/java/jvm/jvm-architecture">JAVA</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/wiki/docs/java/jvm/jvm-architecture">Java虚拟机</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/jvm-architecture">JVM 架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/class_file">class文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/datatype">数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/runtime">jvm 运行时数据区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/ClassLoader">类加载器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/link">加载链接和初始化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/jit">JIT 编译器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/jvm/how">JVM 的运行原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/wiki/docs/java/jvm/oom">理解 OutofmemoryError</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/wiki/docs/java/gc/Introduction">Java垃圾回收</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/wiki/docs/java/Concurrency/">并发和多线程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/wiki/docs/java/profiling/jmm_profiling">性能调优</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/db/profiling/sql">DB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/bigdata/hbase/hbase-architecture">BIGDATA</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/math/quick-power">MATH</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/momd/momd-1">MOMD</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/NLP/supervised-ml-sentiment-analysis">NLP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/git/git-pathspece">GIT</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/questions/java/class_file">INTERVIEWS</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/wiki/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">JAVA</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Java虚拟机</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">理解 OutofmemoryError</span><meta itemprop="position" content="3"></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>理解 OutofmemoryError</h1></header><p>内存泄漏的一个常见指示是 <code>java.lang.OutOfMemoryError</code> 异常。</p><ul><li>通常，当没有足够的空间在 Java 堆中分配对象时，会抛出此错误。在这种情况下，垃圾收集器无法使空间可用于容纳新对象，并且无法进一步扩展堆。</li><li>此外，当本机内存不足以支持加载 Java 类时，可能会抛出此错误。</li><li>在极少数情况下，当花费过多的时间进行垃圾收集并且释放的内存很少时，可能会抛出 java.lang.OutOfMemoryError。</li></ul><p>抛出 <code>java.lang.OutOfMemoryError</code> 异常时，还会打印堆栈跟踪。</p><p>当无法满足本地内存分配时（例如，如果交换空间不足），本地库代码(native)也可以抛出 java.lang.OutOfMemoryError 异常。</p><p>解决 OutOfMemoryError 异常首先要确定异常的原因。是因为 Java 堆已满，还是因为本机堆已满？下面是一些常见的异常原因及解决办法：</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Exception in thread thread_name: java.lang.OutOfMemoryError: Java heap space</summary><div><div class="collapsibleContent_i85q"><div><div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原因：表示无法在 Java堆中分配对象。</summary><div><div class="collapsibleContent_i85q"><div>此错误不一定意味着内存泄漏。问题可能是简单的配置问题，其中指定的堆大小（或默认大小，如果未指定）对于应用程序来说是不够的。</div><br><div>在其他情况下，特别是对于长期存在的应用程序，该消息可能表示应用程序无意中持有对象的引用，这会防止对象被垃圾回收。在 Java 语言相当于内存泄漏。注意：应用程序调用的 API 也可能无意中持有对象引用。</div></div></div></details></div><br><div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>另一个可能的原因是： 过度使用终结器</summary><div><div class="collapsibleContent_i85q"><div>如果一个类有一个 finalize 方法，那么该类型的对象在垃圾收集时没有回收它们的空间。相反，在垃圾收集之后，对象排队等待完成。</div><br><div>在 Oracle Sun 实现中，终结器由为终结队列提供服务的守护程序线程执行。如果终结器线程无法跟上最终化队列，那么 Java 堆可能会填满，并且会抛出这种类型的 OutOfMemoryError 异常。</div><br><div>可能导致这种情况的一种情况是，应用程序创建高优先级线程，导致最终化队列以比终结器线程为该队列服务的速率更快的速率增加。</div></div></div></details></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Exception in thread thread_name: java.lang.OutOfMemoryError: GC Overhead limit exceeded </summary><div><div class="collapsibleContent_i85q"><div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原因：表示垃圾收集器一直在运行，但是进展非常缓慢。</summary><div><div class="collapsibleContent_i85q"><div> 在垃圾收集之后，如果 Java 进程花费超过大约 98％的时间进行垃圾收集，但是回收少于 2％的堆，且持续到目前为止连续 5 个（编译时常量）垃圾 收集，然后抛出 java.lang.OutOfMemoryError。 通常会抛出此异常，因为实时数据量几乎不适合 Java 堆，新分配的可用空间很小。</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>操作：增加堆大小。</summary><div><div class="collapsibleContent_i85q"><div> 可以使用命令行标志-XX：-UseGCOverheadLimit 关闭超出 GC Overhead 限制的 java.lang.OutOfMemoryError 异常。</div></div></div></details></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Exception in thread thread_name: java.lang.OutOfMemoryError: Requested array size exceeds VM limit</summary><div><div class="collapsibleContent_i85q"><div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原因：表示应用程序（或该应用程序使用的 API）尝试分配超出堆大小的数组。</summary><div><div class="collapsibleContent_i85q"><div> 例如，如果应用程序尝试分配 512 MB 的数组但最大堆大小为 256 MB，则将抛出 OutOfMemoryError: Requested array size exceeds VM limit</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>操作：通常问题是配置问题（堆大小太小），或导致应用程序尝试创建大型数组的错误。</summary><div><div class="collapsibleContent_i85q"><div>例如，当使用计算的算法计算数组中的元素数时 大小不正确</div></div></div></details></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Exception in thread thread_name: java.lang.OutOfMemoryError: Metaspace</summary><div><div class="collapsibleContent_i85q"><div>原因：Java 类元数据（Java 类的虚拟机内部表示）在本机内存中分配（此处称为元空间如果类元数据的元空间用尽，此异常。可用于类元数据的元空间量受参数 MaxMetaSpaceSize 的限制，该参数在命令行中指定。当类元数据所需的本机内存量超过 MaxMetaSpaceSize 时，将抛出带有详细 MetaSpace 的 java.lang.OutOfMemoryError 异常。</div><br><div>操作：如果已在命令行上设置 MaxMetaSpaceSize，则增加其值。MetaSpace 是从与 Java 堆相同的地址空间分配的。减小 Java 堆的大小将为 MetaSpace 提供更多可用空间。如果 Java堆中有足够的可用空间，这将是一个正确的权衡。</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Exception in thread thread_name: java.lang.OutOfMemoryError: request size bytes for reason. Out of swap space?</summary><div><div class="collapsibleContent_i85q"><div>原因：详细消息“request size bytes for reason. Out of swap space?？”似乎是 OutOfMemoryError 异常。但是，当来自本机堆的分配失败并且本机堆可能接近耗尽时，Java HotSpot VM 代码会报告此明显异常。该消息指示失败的请求的大小（以字节为单位）以及内存请求的原因。</div><br><div>操作：当抛出此错误消息时，VM 将调用致命错误处理机制（即，它会生成致命错误日志文件，其中包含有关崩溃时线程，进程和系统的有用信息）。在本机堆耗尽的情况下，日志中的堆内存和内存映射信息可能很有用。如果抛出此类型的 OutOfMemoryError 异常，则可能需要使用操作系统上的故障排除实用程序来进一步诊断问题。</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Exception in thread thread_name: java.lang.OutOfMemoryError: Compressed class space</summary><div><div class="collapsibleContent_i85q"><div>原因：在 64 位平台上，指向类元数据的指针可以用 32 位偏移量表示（使用 UseCompressedOops）。这由命令行标志 UseCompressedClassPointers（默认情况下为 on）控制。如果使用 UseCompressedClassPointers，则可用于类元数据的空间量固定为 CompressedClassSpaceSize。如果 UseCompressedClassPointers 所需的空间超出 CompressedClassSpaceSize，则抛出带有详细压缩类空间的 java.lang.OutOfMemoryError。</div><br><div>操作：增加 CompressedClassSpaceSize 以关闭 UseCompressedClassPointers。注意：CompressedClassSpaceSize 的可接受大小有界限。例如-XX：CompressedClassSpaceSize = 4g，超出可接受的界限将导致消息如 CompressedClassSpaceSize 为 4294967296 无效;必须介于 1048576 和 3221225472 之间。</div><br><div>注意：有多种类元数据--klass 元数据和其他元数据。只有 klass 元数据存储在 CompressedClassSpaceSize 限定的空间中。其他元数据存储在 Metaspace 中。</div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Exception in thread thread_name: java.lang.OutOfMemoryError: reason stack_trace_with_native_method</summary><div><div class="collapsibleContent_i85q"><div>原因：如果错误消息的详细信息部分是“reason stack_trace_with_native_method”并且打印了堆栈跟踪，则表明本机方法遇到分配失败。 此消息与上一条消息之间的区别在于，在 Java 本机接口（JNI）或本机方法中检测到分配失败，而不是在 JVM 代码中检测到。</div><br><div>操作：如果抛出此类型的 OutOfMemoryError 异常，则可能需要使用操作系统的本机实用程序来进一步诊断问题。</div></div></div></details></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/wiki/docs/java/jvm/how"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">JVM 的运行原理</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/wiki/docs/java/gc/Introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GC简介</div></a></nav></div></div></div></div></main></div></div></div>
<script src="/wiki/assets/js/runtime~main.356aa08e.js"></script>
<script src="/wiki/assets/js/main.1a942207.js"></script>
</body>
</html>