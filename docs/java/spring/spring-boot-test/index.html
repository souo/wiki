<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-java/spring/spring-boot-test">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/wiki/blog/rss.xml" title="Dev Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/wiki/blog/atom.xml" title="Dev Wiki Atom Feed">




<link rel="stylesheet" href="/wiki/katex/katex.min.css"><title data-rh="true">SpringBoot Test | Dev Wiki</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://souo.gitee.io/wiki/docs/java/spring/spring-boot-test"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SpringBoot Test | Dev Wiki"><meta data-rh="true" name="description" content="Spring Boot Test 是在Spring Test之上的再次封装，增加了切片测试，增强了mock能力。"><meta data-rh="true" property="og:description" content="Spring Boot Test 是在Spring Test之上的再次封装，增加了切片测试，增强了mock能力。"><link data-rh="true" rel="canonical" href="http://souo.gitee.io/wiki/docs/java/spring/spring-boot-test"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/spring/spring-boot-test" hreflang="en"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/spring/spring-boot-test" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://undefined-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/wiki/assets/css/styles.a6de386b.css">
<link rel="preload" href="/wiki/assets/js/runtime~main.356aa08e.js" as="script">
<link rel="preload" href="/wiki/assets/js/main.1a942207.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/wiki/"><b class="navbar__title text--truncate">知识库</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/wiki/get-started">Get Started</a><a class="navbar__item navbar__link" href="/wiki/docs/welcome">Docs</a><a class="navbar__item navbar__link" href="/wiki/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">WIKI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/wiki/docs/java/jvm/jvm-architecture">Java</a></li><li><a class="dropdown__link" href="/wiki/docs/bigdata/hbase/hbase-architecture">BigData</a></li><li><a class="dropdown__link" href="/wiki/docs/math/quick-power">math</a></li><li><a class="dropdown__link" href="/wiki/docs/db/profiling/sql">数据库</a></li><li><a class="dropdown__link" href="/wiki/docs/questions/java/class_file">面试题</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>SpringBoot Test</h1></header><p>Spring Boot Test 是在Spring Test之上的再次封装，增加了切片测试，增强了mock能力。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="单元测试">单元测试<a class="hash-link" href="#单元测试" title="Direct link to heading">​</a></h2><ul><li><p><code>@RunWith</code>是Junit4提供的注解，将Spring和Junit链接了起来</p></li><li><p><code>@SpringBootTes</code>t替代了spring-test中的<code>@ContextConfiguration</code>注解，目的是加载ApplicationContext，启动spring容器</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="功能测试">功能测试<a class="hash-link" href="#功能测试" title="Direct link to heading">​</a></h2><p>使用<code>@SpringBootTest</code>后，Spring将加载所有被管理的bean，基本等同于启动了整个服务, 此时可进行功能测试</p><p>默认情况下，<code>@ SpringBootTest</code>将不会启动服务器。 可以使用<code>@SpringBootTest</code>的<code>webEnvironment</code>属性来进一步优化测试的运行方式：</p><ul><li>MOCK：此值为默认值，该类型提供一个mock环境，可以和@AutoConfigureMockMvc或@AutoConfigureWebTestClient搭配使用，开启Mock相关的功能。注意此时内嵌的服务（servlet容器）并没有真正启动，也不会监听web服务端口。</li><li>RANDOM_PORT：启动一个真实的web服务，监听一个随机端口。</li><li>DEFINED_PORT：启动一个真实的web服务，监听一个定义好的端口（从application.properties读取）。</li><li>NONE：启动一个非web的ApplicationContext，既不提供mock环境，也不提供真实的web服务。</li></ul><blockquote><p>注：如果当前服务的classpath中没有包含web相关的依赖，spring将启动一个非web的ApplicationContext，此时的webEnvironment就没有什么意义了</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="切片测试">切片测试<a class="hash-link" href="#切片测试" title="Direct link to heading">​</a></h2><p>通过@*Test开启具体模块的测试支持，开启后spring仅加载相关的bean，无关内容不会被加载。</p><p>使用@WebMvcTest用来校验controllers是否正常工作的示例</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@RunWith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@WebMvcTest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">controllers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">DemoController</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">DemoControllerApiTest</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token class-name">MockMvc</span><span class="token plain"> mockMvc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@MockBean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">PersonRepository</span><span class="token plain"> personRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">shouldReturnHelloWorld</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        mockMvc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">perform</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/hello&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">andExpect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Hello World!&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">andExpect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">is2xxSuccessful</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="注解详解">注解详解<a class="hash-link" href="#注解详解" title="Direct link to heading">​</a></h2><p>从功能上讲，Spring Boot Test中的注解主要分如下几类：</p><ul><li>配置类型：<code>@TestConfiguration</code>等。提供一些测试相关的配置入口。</li><li>mock类型：<code>@MockBean</code>等。提供mock支持。</li><li>启动测试类型：@SpringBootTest。以Test结尾的注解，具有加载applicationContext的能力。</li><li>自动配置类型：<code>@AutoConfigureJdbc</code>等。以AutoConfigure开头的注解，具有加载测试支持功能的能力。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置类型的注解">配置类型的注解<a class="hash-link" href="#配置类型的注解" title="Direct link to heading">​</a></h3><ul><li>@TestComponent：该注解是另一种@Component，在语义上用来指定某个Bean是专门用于测试的。该注解适用于测试代码和正式混合在一起时，不加载被该注解描述的Bean，使用不多。</li><li>@TestConfiguration：该注解是另一种@TestComponent，它用于补充额外的Bean或覆盖已存在的Bean。在不修改正式代码的前提下，使配置更加灵活。</li><li>@TypeExcludeFilters：用来排除@TestConfiguration和@TestComponent。适用于测试代码和正式代码混合的场景，使用不多。</li><li>@OverrideAutoConfiguration：可用于覆盖@EnableAutoConfiguration，与ImportAutoConfiguration结合使用，以限制所加载的自动配置类。在不修改正式代码的前提下，提供了修改配置自动配置类的能力。</li><li>@PropertyMapping：定义@AutoConfigure*注解中用到的变量名称，例如在@AutoConfigureMockMvc中定义名为spring.test.mockmvc.webclient.enabled的变量。一般不使用。
使用@SpringBootApplication启动测试或者生产代码，被@TestComponent描述的Bean会自动被排除掉。如果不是则需要向@SpringBootApplication添加TypeExcludeFilter。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mock类型的注解">mock类型的注解<a class="hash-link" href="#mock类型的注解" title="Direct link to heading">​</a></h3><ul><li><p>@MockBean：用于mock指定的class或被注解的属性。</p></li><li><p>@MockBeans：使@MockBean支持在同一类型或属性上多次出现。</p></li><li><p>@SpyBean：用于spy指定的class或被注解的属性。</p></li><li><p>@SpyBeans：使@SpyBean支持在同一类型或属性上多次出现</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自动配置类型的注解autoconfigure">自动配置类型的注解（@AutoConfigure*）<a class="hash-link" href="#自动配置类型的注解autoconfigure" title="Direct link to heading">​</a></h3><p>这些注解可以搭配<code>@\*Test</code>使用，用于开启在<code>@\*Test</code>中未自动配置的功能。例如<code>@SpringBootTest</code>和<code>@AutoConfigureMockMvc</code>组合后，就可以注入<code>org.springframework.test.web.servlet.MockMvc</code>。</p><p>自动配置类型有两种方式：</p><ul><li><p>功能测试（即使用<code>@SpringBootTest</code>）时显示添加。</p></li><li><p>一般在切片测试中被隐式使用，例如<code>@WebMvcTest</code>注解时，隐式添加了<code>@AutoConfigureCache</code>、<code>@AutoConfigureWebMvc</code>、<code>@AutoConfigureMockMvc</code>。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动测试类型的注解test">启动测试类型的注解（@*Test）<a class="hash-link" href="#启动测试类型的注解test" title="Direct link to heading">​</a></h3><p>除了<code>@SpringBootTest</code>之外的注解都是用来进行切面测试的，他们会默认导入一些自动配置。</p><p>一般情况下，推荐使用<code>@SpringBootTest</code>而非其它切片测试的注解，简单有效。若某次改动仅涉及特定切片，可以考虑使用切片测试。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#单元测试" class="table-of-contents__link toc-highlight">单元测试</a></li><li><a href="#功能测试" class="table-of-contents__link toc-highlight">功能测试</a></li><li><a href="#切片测试" class="table-of-contents__link toc-highlight">切片测试</a></li><li><a href="#注解详解" class="table-of-contents__link toc-highlight">注解详解</a><ul><li><a href="#配置类型的注解" class="table-of-contents__link toc-highlight">配置类型的注解</a></li><li><a href="#mock类型的注解" class="table-of-contents__link toc-highlight">mock类型的注解</a></li><li><a href="#自动配置类型的注解autoconfigure" class="table-of-contents__link toc-highlight">自动配置类型的注解（@AutoConfigure*）</a></li><li><a href="#启动测试类型的注解test" class="table-of-contents__link toc-highlight">启动测试类型的注解（@*Test）</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/wiki/assets/js/runtime~main.356aa08e.js"></script>
<script src="/wiki/assets/js/main.1a942207.js"></script>
</body>
</html>