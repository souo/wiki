<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-java/spring/security/spring-security-3">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/wiki/blog/rss.xml" title="Dev Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/wiki/blog/atom.xml" title="Dev Wiki Atom Feed">




<link rel="stylesheet" href="/wiki/katex/katex.min.css"><title data-rh="true">摘要认证 | Dev Wiki</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://souo.gitee.io/wiki/docs/java/spring/security/spring-security-3"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="摘要认证 | Dev Wiki"><meta data-rh="true" name="description" content="你不应该在现代应用程序中使用摘要，因为它不被认为是安全的。最明显的问题是您必须以明文、加密或MD5格式存储密码。所有这些存储格式都被认为不安全。相反，您应该使用单向自适应密码散列（即bCrypt、PBKDF2、SCrypt等。"><meta data-rh="true" property="og:description" content="你不应该在现代应用程序中使用摘要，因为它不被认为是安全的。最明显的问题是您必须以明文、加密或MD5格式存储密码。所有这些存储格式都被认为不安全。相反，您应该使用单向自适应密码散列（即bCrypt、PBKDF2、SCrypt等。"><link data-rh="true" rel="canonical" href="http://souo.gitee.io/wiki/docs/java/spring/security/spring-security-3"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/spring/security/spring-security-3" hreflang="en"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/spring/security/spring-security-3" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://undefined-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/wiki/assets/css/styles.a6de386b.css">
<link rel="preload" href="/wiki/assets/js/runtime~main.356aa08e.js" as="script">
<link rel="preload" href="/wiki/assets/js/main.1a942207.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/wiki/"><b class="navbar__title text--truncate">知识库</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/wiki/get-started">Get Started</a><a class="navbar__item navbar__link" href="/wiki/docs/welcome">Docs</a><a class="navbar__item navbar__link" href="/wiki/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">WIKI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/wiki/docs/java/jvm/jvm-architecture">Java</a></li><li><a class="dropdown__link" href="/wiki/docs/bigdata/hbase/hbase-architecture">BigData</a></li><li><a class="dropdown__link" href="/wiki/docs/math/quick-power">math</a></li><li><a class="dropdown__link" href="/wiki/docs/db/profiling/sql">数据库</a></li><li><a class="dropdown__link" href="/wiki/docs/questions/java/class_file">面试题</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>摘要认证</h1></header><blockquote><p>你不应该在现代应用程序中使用摘要，因为它不被认为是安全的。最明显的问题是您必须以明文、加密或MD5格式存储密码。所有这些存储格式都被认为不安全。相反，您应该使用单向自适应密码散列（即bCrypt、PBKDF2、SCrypt等。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="改进">改进<a class="hash-link" href="#改进" title="Direct link to heading">​</a></h2><p>基本认证便捷灵活，但极不安全。用户名和密码都是以明文形式（只用Base64编码进行了扰码，没有任何防止用户攻击的手段）传送的。
摘要认证是另一种 HTTP 认证协议，它试图修复基本认证协议的严重缺陷。具体来说，摘要认证进行了如下改进。</p><ul><li>永远不会以明文方式在网络上发送密码。</li><li>可以防止恶意用户捕获并重放认证的握手过程。</li><li>可以有选择地防止对报文内容的篡改。</li><li>防范其他几种常见的攻击方式。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="工作原理">工作原理<a class="hash-link" href="#工作原理" title="Direct link to heading">​</a></h2><ol><li>客户端请求了某个受保护文档。</li><li>在客户端能够证明其知道密码从而确认其身份之前，服务器拒绝提供文档。服务器向客户端发起质询，询问用户名和摘要形式的密码。</li><li>客户端传递了密码的摘要，证明它是知道密码的。服务器知道所有用户的秘密，因此可以将客户提供的摘要与服务器自己计算得到的摘要进行比较，以验证用户是否知道密码。另一方在不知道密码的情况下，很难伪造出正确的摘要。</li><li>服务器将客户端提供的摘要与服务器内部计算出的摘要进行对比。如果匹配，就说明客户端知道密码（或者很幸运地猜中了！）。可以设置摘要函数，使其产生很多数字，让人不可能幸运地猜中摘要。服务器进行了匹配验证之后，会将文档提供给客户端——整个过程都没有在网络上发送密码。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="重放攻击">重放攻击<a class="hash-link" href="#重放攻击" title="Direct link to heading">​</a></h2><p>使用摘要就无需以明文形式发送密码了。可以只发送密码的摘要，而且可以确信，没有哪个恶意用户能轻易地从摘要中解码出原始密码。</p><p>但是，仅仅隐藏密码并不能避免危险，因为即便不知道密码，别有用心的人也可以截获摘要，并一遍遍地重放给服务器。摘要和密码一样好用。</p><p>为防止此类重放攻击的发生，服务器可以向客户端发送了一个称为随机数 (nonce) 的特殊令牌，这个数会经常发生变化（可能是每毫秒，或者是每次认证都变化）。客户端在计算摘要之前要先将这个随机数令牌附加到密码上去。</p><p>在密码中加入随机数就会使摘要随着随机数的每一次变化而变化。记录下的密码摘要只对特定的随机数有效，而没有密码的话，攻击者就无法计算出正确的摘要，这样就可以防止重放攻击的发生。</p><p>摘要认证要求使用随机数，因为这个小小的重放弱点会使未随机化的摘要认证变得和基本认证一样脆弱。随机数是在 WWW-Authenticate 质询中从服务器传送给客户端。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="digestauthenticationfilter">DigestAuthenticationFilter<a class="hash-link" href="#digestauthenticationfilter" title="Direct link to heading">​</a></h2><p>DigestAuthenticationFilter 能够处理在 HTTP 头中显示的摘要身份验证凭据。摘要认证尝试解决基本认证的许多弱点，特别是通过确保凭证不会以明文方式通过网络发送。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a class="hash-link" href="#配置" title="Direct link to heading">​</a></h2><p>要实现 HTTP 摘要认证，需要在过滤器链中定义 DigestAuthenticationFilter。  同时需要配置 UserDetailsS​​ervice，因为 DigestAuthenticationFilter 必须能够直接访问用户的明文密码。如果在 DAO 中使用编码密码，Digest 身份验证将不会工作（如果DigestAuthenticationFilter.passwordAlreadyEncoded设置为true，则可以以HEX（MD5（username：realm：password））格式对密码进行编码。但是，其他密码编码将无法使用摘要身份验证。）。 DAO 协作者以及 UserCache 通常直接与 DaoAuthenticationProvider 共享。 authenticationEntryPoint 属性必须为 DigestAuthenticationEntryPoint，以便 DigestAuthenticationFilter 可以获取正确 的realmName 和摘要计算的键。</p><p>像 BasicAuthenticationFilter 一样，如果认证成功，那么认证请求令牌将被放入 SecurityContextHolder。如果认证事件成功，或者未尝试认证，因为HTTP头不包含摘要认证请求，则过滤器链将正常继续。过滤器链将被中断的唯一时机是如果认证失败并且调用了AuthenticationEntryPoint。</p><p>摘要认证的 RFC 提供了一系列附加功能，以进一步提高安全性。例如，可以在每个请求时更改随机数。尽管如此，Spring Security 实现旨在最小化实现的复杂性（以及将出现的无疑的用户代理不兼容性），并避免需要存储服务器端状态。如果您想更详细地了解这些功能，请受邀查看RFC 2617。据我们所知，Spring Security的实现确实符合该 RFC 的最低标准。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#改进" class="table-of-contents__link toc-highlight">改进</a></li><li><a href="#工作原理" class="table-of-contents__link toc-highlight">工作原理</a></li><li><a href="#重放攻击" class="table-of-contents__link toc-highlight">重放攻击</a></li><li><a href="#digestauthenticationfilter" class="table-of-contents__link toc-highlight">DigestAuthenticationFilter</a></li><li><a href="#配置" class="table-of-contents__link toc-highlight">配置</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/wiki/assets/js/runtime~main.356aa08e.js"></script>
<script src="/wiki/assets/js/main.1a942207.js"></script>
</body>
</html>