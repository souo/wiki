<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-java/gc/gc_algorithm">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/wiki/blog/rss.xml" title="Dev Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/wiki/blog/atom.xml" title="Dev Wiki Atom Feed">




<link rel="stylesheet" href="/wiki/katex/katex.min.css"><title data-rh="true">GC 算法 | Dev Wiki</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://souo.gitee.io/wiki/docs/java/gc/gc_algorithm"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GC 算法 | Dev Wiki"><meta data-rh="true" name="description" content="JVM 提供了不同的回收算法来实现这一套回收机制，通常垃圾收集器的回收算法可以分为以下几种："><meta data-rh="true" property="og:description" content="JVM 提供了不同的回收算法来实现这一套回收机制，通常垃圾收集器的回收算法可以分为以下几种："><link data-rh="true" rel="canonical" href="http://souo.gitee.io/wiki/docs/java/gc/gc_algorithm"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/gc/gc_algorithm" hreflang="en"><link data-rh="true" rel="alternate" href="http://souo.gitee.io/wiki/docs/java/gc/gc_algorithm" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://undefined-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/wiki/assets/css/styles.a6de386b.css">
<link rel="preload" href="/wiki/assets/js/runtime~main.356aa08e.js" as="script">
<link rel="preload" href="/wiki/assets/js/main.1a942207.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/wiki/"><b class="navbar__title text--truncate">知识库</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/wiki/get-started">Get Started</a><a class="navbar__item navbar__link" href="/wiki/docs/welcome">Docs</a><a class="navbar__item navbar__link" href="/wiki/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">WIKI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/wiki/docs/java/jvm/jvm-architecture">Java</a></li><li><a class="dropdown__link" href="/wiki/docs/bigdata/hbase/hbase-architecture">BigData</a></li><li><a class="dropdown__link" href="/wiki/docs/math/quick-power">math</a></li><li><a class="dropdown__link" href="/wiki/docs/db/profiling/sql">数据库</a></li><li><a class="dropdown__link" href="/wiki/docs/questions/java/class_file">面试题</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/welcome">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/wiki/docs/java/jvm/jvm-architecture">JAVA</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/wiki/docs/java/jvm/jvm-architecture">Java虚拟机</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/wiki/docs/java/gc/Introduction">Java垃圾回收</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/gc/Introduction">GC简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/wiki/docs/java/gc/gc_algorithm">GC 算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wiki/docs/java/gc/collector">垃圾收集器</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/wiki/docs/java/Concurrency/">并发和多线程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/wiki/docs/java/profiling/jmm_profiling">性能调优</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/db/profiling/sql">DB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/bigdata/hbase/hbase-architecture">BIGDATA</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/math/quick-power">MATH</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/momd/momd-1">MOMD</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/NLP/supervised-ml-sentiment-analysis">NLP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/git/git-pathspece">GIT</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/wiki/docs/questions/java/class_file">INTERVIEWS</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/wiki/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">JAVA</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Java垃圾回收</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">GC 算法</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>GC 算法</h1></header><p>JVM 提供了不同的回收算法来实现这一套回收机制，通常垃圾收集器的回收算法可以分为以下几种：</p><ul><li>标记-清除算法</li><li>复制算法</li><li>标记-整理（compact）算法</li><li>分代收集算法</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="标记-清除算法">标记-清除算法<a class="hash-link" href="#标记-清除算法" title="Direct link to heading">​</a></h2><p>算法分 为“标记”和“清除”两个阶段:</p><ul><li>首先标记出所有需要回收的对象</li><li>在标记完成后统一回收所有被标记的对象</li></ul><p>主要不足有两个:</p><ul><li>一个是效率问题，标记和清除两个过程的效率都不高</li><li>另一个是 空间问题，标记清除之后会产生大量不连续的内存碎片,空间碎片太多可能会导致以后在程 序运行过程中需要分配较大对象时，无法找到足够的连续内存而不得不提前触发另一次垃圾 收集动作。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="复制算法">复制算法<a class="hash-link" href="#复制算法" title="Direct link to heading">​</a></h2><p>它将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着 的对象复制到另外一块上面，然后再把已使用过的内存空间一次清理掉。</p><p>现在的商业虚拟机都采用这种收集算法来回收新生代, IBM 公司的专门研究表明，新生 代中的对象 98%是“朝生夕死”的，所以并不需要按照 1:1 的比例来划分内存空间，而是将内存 分为一块较大的 Eden 空间和两块较小的 Survivor 空间，每次使用 Eden 和其中一块 Survivor 。 当回收时，将 Eden 和 Survivor 中还存活着的对象一次性地复制到另外一块 Survivor 空间上，最 后清理掉 Eden 和刚才用过的 Survivor 空间。</p><p>优点： 不会产生内存碎片
缺点：内存使用率低，且有可能产生频繁复制。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="标记-整理compact算法">标记-整理（compact）算法<a class="hash-link" href="#标记-整理compact算法" title="Direct link to heading">​</a></h2><p>复制收集算法在对象存活率较高时就要进行较多的复制操作，效率将会变低。</p><p>根据老年代的特点，有人提出了另外一种“标记-整理”（Mark-Compact）算法，标记过程 仍然与“标记-清除”算法一样，但后续步骤不是直接对可回收对象进行清理，而是让所有存活的对象都向一端移动，然后直接清理掉端边界以外的内存。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="分代收集算法">分代收集算法<a class="hash-link" href="#分代收集算法" title="Direct link to heading">​</a></h2><p>基于一下两个观察事实:</p><ul><li>大多数分配的对象生存时间较短</li><li>存活时间久的对象很少引用存活时间短的对象</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="新生代收集">新生代收集<a class="hash-link" href="#新生代收集" title="Direct link to heading">​</a></h3><p>大多数新创建的对象被分配到新生代，新生代收集（称为 Minor GC）之后存活的对象很少，通常垃圾收集效率较高。通常使用复制算法。</p><ul><li>Eden：大多数新对象分配在这里（大对象可能之间分配在老年代）</li><li>Survivor（一对）：这里存放的对象至少经过一次 GC，它们在提升到老年代之前还有一次回收机会</li><li>新生代的 Eden 和 Survivor￼</li></ul><p align="center"><img loading="lazy" src="/wiki/assets/GC/gc_1_1.png" width="70%" class="img_ev3q"> <br></p><ul><li>Minor GC 后 Eden 中的存活对象被复制到未使用的 survivor 中，占用的 survivor 中不够老的对象被复制到未使用的 survivor 中，足够老的的存活对象被提升到老年代</li><li>Minor GC 后两个 survivor 交换角色，Eden 完全为空。</li><li>在 GC 过程中 survivor 可能不足以容纳全部存活对象，如果 survivor 溢出，多余的对象将被提升到老年代，这称为过早提升。这会导致老年代中短期存活对象的增长，可能引发严重的性能问题。</li><li>进一步说，minorGC 后老年代满了，会引发 Full GC，这称为提升失败。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="老年代收集">老年代收集<a class="hash-link" href="#老年代收集" title="Direct link to heading">​</a></h3><p>新生代中长期存活的对象最后被提升到老年代。老年代收集（称为 Full GC）执行频率较低，但是一旦发生，执行时间就会很长。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="stw">STW<a class="hash-link" href="#stw" title="Direct link to heading">​</a></h2><p>STW（stop-the-world），顾名思义，为便于执行垃圾回收而暂停所有应用程序的所有 Java 线程。Java 虚拟机中的 STW 是通过安全点（safepoint）机制来实现的。当 Java 虚拟机收到 STW 请求，它便会等待所有的线程都到达安全点，才允许请求 STW 的线程进行独占的工作。</p><p>垃圾回收可能会移动堆上的对象，例如执行内存整理操作。但原先指向这些对象的对象指针 的值却并没有发生变化，那么应用程序再次运行的时候就会出现错误，所以垃圾回收器必须更新 这些对象指针的值，将之指向对象的新位置，而更新操作需要同步进行，防止对象位置再次发生 改变。</p><p>不管什么GC，都会STW，区别是发生的时间长短。而这个时间跟垃圾收集器又有关系，Serial、PartNew、Parallel Scavenge收集器无论是串行还是并行，都会挂起用户线程，而CMS和G1在并发标记时，是不会挂起用户线程，但其他时候一样会挂起用户线程，stop the world的时间相对来说小很多了。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/wiki/docs/java/gc/Introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">GC简介</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/wiki/docs/java/gc/collector"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">垃圾收集器</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#标记-清除算法" class="table-of-contents__link toc-highlight">标记-清除算法</a></li><li><a href="#复制算法" class="table-of-contents__link toc-highlight">复制算法</a></li><li><a href="#标记-整理compact算法" class="table-of-contents__link toc-highlight">标记-整理（compact）算法</a></li><li><a href="#分代收集算法" class="table-of-contents__link toc-highlight">分代收集算法</a><ul><li><a href="#新生代收集" class="table-of-contents__link toc-highlight">新生代收集</a></li><li><a href="#老年代收集" class="table-of-contents__link toc-highlight">老年代收集</a></li></ul></li><li><a href="#stw" class="table-of-contents__link toc-highlight">STW</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/wiki/assets/js/runtime~main.356aa08e.js"></script>
<script src="/wiki/assets/js/main.1a942207.js"></script>
</body>
</html>